@namespace NonProfitFinance.Components.Shared

<div class="pagination-container @(Compact ? "pagination-compact" : "")">
    @if (ShowItemCount)
    {
        <div class="pagination-info">
            <span class="pagination-info-text">
                Showing @(FirstItemIndex) - @(LastItemIndex) of @TotalItems
            </span>
        </div>
    }

    <div class="pagination-controls">
        @if (ShowFirstLast)
        {
            <button class="pagination-btn pagination-first"
                    @onclick="GoToFirst"
                    disabled="@(CurrentPage <= 1)"
                    title="First page">
                <i class="fas fa-angle-double-left"></i>
            </button>
        }

        <button class="pagination-btn pagination-prev"
                @onclick="GoToPrevious"
                disabled="@(CurrentPage <= 1)"
                title="Previous page">
            <i class="fas fa-angle-left"></i>
            @if (!Compact)
            {
                <span class="btn-text">Previous</span>
            }
        </button>

        @if (ShowPageNumbers)
        {
            <div class="pagination-pages">
                @foreach (var page in GetPageNumbers())
                {
                    @if (page == -1)
                    {
                        <span class="pagination-ellipsis">â€¦</span>
                    }
                    else
                    {
                        <button class="pagination-btn pagination-page @(page == CurrentPage ? "active" : "")"
                                @onclick="() => GoToPage(page)"
                                disabled="@(page == CurrentPage)">
                            @(page)
                        </button>
                    }
                }
            </div>
        }
        else
        {
            <span class="pagination-current">
                Page @CurrentPage of @TotalPages
            </span>
        }

        <button class="pagination-btn pagination-next"
                @onclick="GoToNext"
                disabled="@(CurrentPage >= TotalPages)"
                title="Next page">
            @if (!Compact)
            {
                <span class="btn-text">Next</span>
            }
            <i class="fas fa-angle-right"></i>
        </button>

        @if (ShowFirstLast)
        {
            <button class="pagination-btn pagination-last"
                    @onclick="GoToLast"
                    disabled="@(CurrentPage >= TotalPages)"
                    title="Last page">
                <i class="fas fa-angle-double-right"></i>
            </button>
        }
    </div>

    @if (ShowPageSizeSelector)
    {
        <div class="pagination-size">
            <label class="pagination-size-label">
                <span>Items per page:</span>
                <select class="pagination-size-select" value="@PageSize" @onchange="OnPageSizeChanged">
                    @foreach (var size in PageSizeOptions)
                    {
                        <option value="@size">@size</option>
                    }
                </select>
            </label>
        </div>
    }
</div>

<style>
    .pagination-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 1rem;
        padding: 0.75rem 0;
    }

    .pagination-compact {
        gap: 0.5rem;
    }

    .pagination-info {
        color: var(--text-muted);
        font-size: 0.875rem;
    }

    .pagination-controls {
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .pagination-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.35rem;
        padding: 0.5rem 0.75rem;
        border: 1px solid var(--border-color);
        background: var(--bg-primary);
        color: var(--text-primary);
        border-radius: var(--radius);
        cursor: pointer;
        transition: all 0.15s ease;
        font-size: 0.875rem;
        min-width: 2.25rem;
        height: 2.25rem;
    }

    .pagination-btn:hover:not(:disabled) {
        background: var(--bg-secondary);
        border-color: var(--primary-color);
        color: var(--primary-color);
    }

    .pagination-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .pagination-btn.active {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
    }

    .pagination-btn.pagination-page {
        min-width: 2.25rem;
        padding: 0.5rem;
    }

    .pagination-pages {
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .pagination-ellipsis {
        padding: 0 0.5rem;
        color: var(--text-muted);
    }

    .pagination-current {
        padding: 0 0.75rem;
        color: var(--text-secondary);
        font-size: 0.875rem;
        white-space: nowrap;
    }

    .pagination-first,
    .pagination-last {
        padding: 0.5rem;
    }

    .pagination-size {
        display: flex;
        align-items: center;
    }

    .pagination-size-label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        color: var(--text-muted);
    }

    .pagination-size-select {
        padding: 0.375rem 0.5rem;
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        background: var(--bg-primary);
        color: var(--text-primary);
        font-size: 0.875rem;
        cursor: pointer;
    }

    .pagination-size-select:hover {
        border-color: var(--primary-color);
    }

    .pagination-compact .pagination-btn {
        padding: 0.375rem 0.5rem;
        min-width: 2rem;
        height: 2rem;
        font-size: 0.8125rem;
    }

    .pagination-compact .btn-text {
        display: none;
    }

    .pagination-compact .pagination-info-text {
        font-size: 0.8125rem;
    }

    @@media (max-width: 640px) {
        .pagination-container {
            flex-direction: column;
            align-items: stretch;
        }

        .pagination-controls {
            justify-content: center;
        }

        .pagination-info,
        .pagination-size {
            justify-content: center;
        }

        .btn-text {
            display: none;
        }

        .pagination-pages {
            display: none;
        }

        .pagination-controls::after {
            content: 'Page ' attr(data-page) ' of ' attr(data-total);
            font-size: 0.875rem;
            color: var(--text-muted);
            padding: 0 0.5rem;
        }
    }
</style>

@code {
    [Parameter] public int CurrentPage { get; set; } = 1;
    [Parameter] public int PageSize { get; set; } = 25;
    [Parameter] public int TotalItems { get; set; }
    [Parameter] public int[] PageSizeOptions { get; set; } = [10, 25, 50, 100];
    [Parameter] public int MaxVisiblePages { get; set; } = 5;
    [Parameter] public bool ShowPageNumbers { get; set; } = true;
    [Parameter] public bool ShowPageSizeSelector { get; set; } = true;
    [Parameter] public bool ShowItemCount { get; set; } = true;
    [Parameter] public bool ShowFirstLast { get; set; } = true;
    [Parameter] public bool Compact { get; set; } = false;
    [Parameter] public EventCallback<int> OnPageChange { get; set; }
    [Parameter] public EventCallback<int> OnPageSizeChange { get; set; }

    private int TotalPages => PageSize > 0 ? (int)Math.Ceiling((double)TotalItems / PageSize) : 1;
    private int FirstItemIndex => TotalItems == 0 ? 0 : (CurrentPage - 1) * PageSize + 1;
    private int LastItemIndex => Math.Min(CurrentPage * PageSize, TotalItems);

    private IEnumerable<int> GetPageNumbers()
    {
        var pages = new List<int>();
        var totalPages = TotalPages;

        if (totalPages <= MaxVisiblePages)
        {
            for (int i = 1; i <= totalPages; i++)
                pages.Add(i);
        }
        else
        {
            pages.Add(1);

            var startPage = Math.Max(2, CurrentPage - (MaxVisiblePages - 3) / 2);
            var endPage = Math.Min(totalPages - 1, startPage + MaxVisiblePages - 4);
            startPage = Math.Max(2, endPage - MaxVisiblePages + 4);

            if (startPage > 2)
                pages.Add(-1); // Ellipsis

            for (int i = startPage; i <= endPage; i++)
                pages.Add(i);

            if (endPage < totalPages - 1)
                pages.Add(-1); // Ellipsis

            pages.Add(totalPages);
        }

        return pages;
    }

    private async Task GoToPage(int page)
    {
        if (page >= 1 && page <= TotalPages && page != CurrentPage)
        {
            await OnPageChange.InvokeAsync(page);
        }
    }

    private async Task GoToFirst() => await GoToPage(1);
    private async Task GoToPrevious() => await GoToPage(CurrentPage - 1);
    private async Task GoToNext() => await GoToPage(CurrentPage + 1);
    private async Task GoToLast() => await GoToPage(TotalPages);

    private async Task OnPageSizeChanged(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out var newSize))
        {
            await OnPageSizeChange.InvokeAsync(newSize);
        }
    }
}
